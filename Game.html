<!DOCTYPE html>
<html lang="fa">
<head>
  <meta charset="UTF-8">
  <title>ZzZstile جم‌خور</title>
  <style>
    body {
      background-color: #111;
      color: #fff;
      font-family: Tahoma, sans-serif;
      text-align: center;
      margin: 0;
      padding: 0;
    }
    #leaderboard {
      background:#222;
      color:#fff;
      padding:10px;
      border-bottom:2px solid lime;
    }
    #leaderboard table {
      width:100%;
      font-size:14px;
      border-collapse:collapse;
    }
    #leaderboard th, #leaderboard td {
      padding:4px;
    }
    #gameArea {
      position: relative;
      height: 400px;
      background-color: #222;
      overflow: hidden;
    }
    #player {
      width: 50px;
      height: 50px;
      background-color: lime;
      position: absolute;
      bottom: 20px;
      left: 50%;
      transform: translateX(-50%);
      border-radius: 50%;
    }
    .gem, .obstacle {
      width: 30px;
      height: 30px;
      position: absolute;
      top: 0;
      border-radius: 50%;
    }
    .gem { background-color: cyan; }
    .obstacle { background-color: red; }
    #controls {
      display: flex;
      justify-content: center;
      gap: 20px;
      margin: 15px 0;
    }
    button {
      padding: 10px 20px;
      font-size: 16px;
      border-radius: 8px;
      cursor: pointer;
    }
    .promo a {
      color: #0ff;
      font-weight: bold;
      font-size: 18px;
      animation: blink 1s infinite;
    }
    @keyframes blink {
      0% { opacity: 1; }
      50% { opacity: 0.4; }
      100% { opacity: 1; }
    }
  </style>
</head>
<body>

<div id="leaderboard">
  <h3>🏆 رکوردهای اخیر ZzZstile</h3>
  <table>
    <tr style="background:#333;">
      <th>نام</th>
      <th>امتیاز</th>
      <th>مدال</th>
    </tr>
    <tr><td>AMIR</td><td>180</td><td>🥇 طلایی</td></tr>
    <tr><td>سارا</td><td>150</td><td>🥈 نقره‌ای</td></tr>
    <tr><td>رضا</td><td>120</td><td>🥉 برنزی</td></tr>
    <tr><td>نازنین</td><td>90</td><td>⚪ بدون مدال</td></tr>
  </table>
</div>

<h2>🎮 بازی ZzZstile جم‌خور</h2>
<p>حرکت کن، جم بگیر، امتیاز بزن، کد تخفیف بگیر!</p>
<button onclick="startGame()">شروع بازی</button>
<div id="timer">⏱ زمان باقی‌مانده: <span id="timeValue">90</span> ثانیه</div>
<div id="gameArea"><div id="player"></div></div>
<div id="controls">
  <button onmousedown="moveLeft()" ontouchstart="moveLeft()">⬅️ چپ</button>
  <button onmousedown="moveRight()" ontouchstart="moveRight()">➡️ راست</button>
</div>
<p>امتیاز: <span id="scoreValue">0</span></p>
<div id="result"></div>
<div class="promo">
  <p>📺 دنبال کن:</p>
  <a href="https://rubika.ir/ZzZstile" target="_blank">روبیکا: ZzZstile</a><br>
  <a href="https://www.aparat.com/ZzZ0stile" target="_blank">آپارات: ZzZstile</a>
</div>
<form id="scoreForm" action="https://formspree.io/f/mvgbvraz" method="POST" style="display:none;">
  <input type="hidden" name="name" id="nameInput">
  <input type="hidden" name="score" id="scoreInput">
  <input type="hidden" name="code" id="codeInput">
  <input type="hidden" name="time" id="timeInput">
  <input type="submit" value="ارسال">
</form>

<script>
let score = 0;
let timeLeft = 90;
let gameInterval;
let timerInterval;
let moveInterval;
const player = document.getElementById("player");
const scoreDisplay = document.getElementById("scoreValue");
const timeDisplay = document.getElementById("timeValue");

function startGame() {
  document.querySelector("button").style.display = "none";
  gameInterval = setInterval(spawnItem, 1000);
  timerInterval = setInterval(() => {
    timeLeft--;
    timeDisplay.textContent = timeLeft;
    if (timeLeft <= 0) endGame();
  }, 1000);
}

function spawnItem() {
  const item = document.createElement("div");
  const isGem = Math.random() > 0.3;
  item.className = isGem ? "gem" : "obstacle";
  item.style.left = Math.random() * window.innerWidth + "px";
  document.body.appendChild(item);

  let topPos = 0;
  const fall = setInterval(() => {
    topPos += 5;
    item.style.top = topPos + "px";
    const playerRect = player.getBoundingClientRect();
    const itemRect = item.getBoundingClientRect();

    if (
      itemRect.top < playerRect.bottom &&
      itemRect.bottom > playerRect.top &&
      itemRect.left < playerRect.right &&
      itemRect.right > playerRect.left
    ) {
      if (isGem) {
        score += 10;
      } else {
        score -= 10;
      }
      scoreDisplay.textContent = score;
      item.remove();
      clearInterval(fall);
      if (score >= 100) endGame();
    }

    if (topPos > window.innerHeight) {
      item.remove();
      clearInterval(fall);
    }
  }, 50);
}

function moveLeft() {
  clearInterval(moveInterval);
  moveInterval = setInterval(() => {
    let left = player.offsetLeft;
    if (left > 0) player.style.left = (left - 10) + "px";
  }, 50);
}

function moveRight() {
  clearInterval(moveInterval);
  moveInterval = setInterval(() => {
    let left = player.offsetLeft;
    if (left < window.innerWidth - player.offsetWidth)
      player.style.left = (left + 10) + "px";
  }, 50);
}

document.addEventListener("mouseup", () => clearInterval(moveInterval));
document.addEventListener("touchend", () => clearInterval(moveInterval));

function endGame() {
  clearInterval(gameInterval);
  clearInterval(timerInterval);

  const name = prompt("اسم خودتو وارد کن:");
  const code = score >= 100 ? "ZZZ-" + score + "-" + Math.floor(Math.random() * 1000) : "بدون کد";
  const now = new Date().toLocaleString("fa-IR");

  document.getElementById("result").innerHTML = `
    🎁 ${score >= 100 ? "آفرین" : "متأسفانه"} ${name}!<br>
    امتیاز: ${score}<br>
    ${score >= 100 ? `کد تخفیف: <b>${code}</b><br><a href="https://zzzstile.ir/order?code=${code}" target="_blank" style="color:lime;">🛒 ثبت سفارش با کد</a>` : "برای دریافت کد، امتیازت باید بالای ۱۰۰ باشه!"}
  `;

  document.getElementById("nameInput").value = name;
  document.getElementById("scoreInput").value = score;
  document.getElementById("codeInput").value = code;
  document.getElementById("timeInput").value = now;
  document.getElementById("scoreForm").submit();

  if (score >= 100) {
    setTimeout(() => {
      window.location.href = "https://zzzstile.ir/leaderboard?name=" + encodeURIComponent(name) + "&score=" + score + "&code=" + code;
    }, 3000);
  }
}
</script>

</body>
</html>